<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSH Analysis Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="estilos.css">

</head>

<body>
    <div class="container">
        <div class="header">
            <h1>SSH Sentinel</h1>
            <p>Monitor and analyze SSH connection performance in real-time</p>
        </div>

        <!-- Bienvenida -->
        <div class="welcome">
            <div>
                <h2 id="greetingTitle">¬°Bienvenido!</h2>
                <p class="welcome-text">
                    Configura tu conexi√≥n SSH y observa m√©tricas en tiempo real. Si es tu primera vez, revisa los tips
                    de abajo.
                </p>
            </div>
        </div>

        <div class="connection-form">
            <form id="analysisForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="host">Host</label>
                        <input type="text" id="host" name="host" value="127.0.0.1" required>
                    </div>
                    <div class="form-group">
                        <label for="port">Port</label>
                        <input type="number" id="port" name="port" value="22" required>
                    </div>
                    <div class="form-group">
                        <label for="user">User</label>
                        <input type="text" id="user" name="user" required autocomplete="username" placeholder="Name">
                    </div>
                    <div class="form-group password-group">
                        <label for="password">Password</label>
                        <div class="input-with-button">
                            <input type="password" id="password" name="password" placeholder="Password" required
                                autocomplete="current-password">
                            <button type="button" class="ghost-btn" id="togglePass"
                                aria-label="Mostrar u ocultar contrase√±a">üëÅÔ∏è</button>
                        </div>
                        <small class="hint">Nunca guardamos tu contrase√±a. √ösala solo en equipos de confianza.</small>
                    </div>

                </div>
                <button type="submit" class="analyze-btn" id="analyzeBtn">
                    Iniciar An√°lisis
                </button>
                <div id="statusMessage" class="status-message" style="display: none;"></div>
            </form>
        </div>

        <div id="dashboard" class="dashboard">
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value errors" id="totalErrors">0</div>
                    <div class="metric-label">Total Errores</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value warnings" id="totalWarnings">0</div>
                    <div class="metric-label">Total Warnings</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value infos" id="totalInfos">0</div>
                    <div class="metric-label">Total Infos</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value speedup" id="speedupValue">0x</div>
                    <div class="metric-label">Speedup Factor</div>
                </div>
            </div>

            <div class="charts-section">
                <div class="chart-container">
                    <div class="chart-title">Distribuci√≥n de Resultados</div>
                    <canvas id="distributionChart" width="400" height="300"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Comparaci√≥n de Tiempos</div>
                    <canvas id="timeChart" width="400" height="300"></canvas>
                </div>
            </div>

            <div class="performance-section">
                <h3 class="chart-title">M√©tricas de Rendimiento</h3>
                <div class="performance-grid">
                    <div class="performance-item">
                        <div class="performance-value" id="efficiencyValue">0%</div>
                        <div class="performance-label">Eficiencia</div>
                    </div>
                    <div class="performance-item">
                        <div class="performance-value parallel" id="parallelTime">0ms</div>
                        <div class="performance-label">Tiempo Paralelo</div>
                    </div>
                </div>
                <div class="time-comparison">
                    <div class="time-item">
                        <div class="time-value sequential" id="sequentialTime">0ms</div>
                        <div class="performance-label">Tiempo Secuencial</div>
                    </div>
                    <div class="time-item">
                        <div class="time-value parallel" id="parallelTimeComp">0ms</div>
                        <div class="performance-label">Tiempo Paralelo</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Secci√≥n de Ayuda / Tips -->
    <section class="helper-grid">
        <article class="helper-card">
            <h3>C√≥mo empezar</h3>
            <ul>
                <li>1) Verifica el <strong>host</strong> y <strong>puerto</strong> (22 por defecto).</li>
                <li>2) Escribe tu <strong>usuario</strong> y contrase√±a.</li>
                <li>3) Presiona <strong>Iniciar An√°lisis</strong> o <kbd>Enter</kbd>.</li>
            </ul>
        </article>

        <article class="helper-card">
            <h3>Buenas pr√°cticas</h3>
            <ul>
                <li>Usa <strong>claves SSH</strong> cuando sea posible.</li>
                <li>Evita redes p√∫blicas para credenciales.</li>
                <li>Rotaci√≥n de contrase√±as y 2FA donde aplique.</li>
            </ul>
        </article>

        <article class="helper-card">
            <h3>Atajos</h3>
            <ul>
                <li><kbd>Tab</kbd> para moverte entre campos.</li>
                <li><kbd>Enter</kbd> para iniciar an√°lisis.</li>
                <li>Click en <strong>üëÅÔ∏è</strong> para ver/ocultar contrase√±a.</li>
            </ul>
        </article>
    </section>

    <script>
        let distributionChart = null;
        let timeChart = null;

        document.getElementById('analysisForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const btn = document.getElementById('analyzeBtn');
            const statusMessage = document.getElementById('statusMessage');
            const dashboard = document.getElementById('dashboard');

            // Show loading state
            btn.innerHTML = '<span class="loading"></span>Analizando...';
            btn.disabled = true;
            statusMessage.style.display = 'none';
            dashboard.classList.remove('active');

            // Get form data
            const formData = {
                host: document.getElementById('host').value,
                port: document.getElementById('port').value,
                user: document.getElementById('user').value,
                password: document.getElementById('password').value
            };

            try {
                const response = await fetch('https://localhost:7082/api/ssh/run', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                // Show success message
                statusMessage.textContent = data.mensaje || 'An√°lisis completado exitosamente';
                statusMessage.className = 'status-message status-success';
                statusMessage.style.display = 'block';

                // Update dashboard with results
                updateDashboard(data.resultado);
                dashboard.classList.add('active');

            } catch (error) {
                console.error('Error:', error);
                statusMessage.textContent = 'Error al realizar el an√°lisis: ' + error.message;
                statusMessage.className = 'status-message status-error';
                statusMessage.style.display = 'block';
            } finally {
                // Reset button
                btn.innerHTML = 'Iniciar An√°lisis';
                btn.disabled = false;
            }
        });

        function updateDashboard(resultado) {
            // Update metric cards
            document.getElementById('totalErrors').textContent = resultado.totalErrores || 0;
            document.getElementById('totalWarnings').textContent = resultado.totalWarnings || 0;
            document.getElementById('totalInfos').textContent = resultado.totalInfos || 0;
            document.getElementById('speedupValue').textContent = (resultado.speedup || 0) + 'x';

            // Update performance metrics
            document.getElementById('efficiencyValue').textContent = Math.round((resultado.eficiencia || 0) * 100) + '%';
            document.getElementById('parallelTime').textContent = (resultado.tiempoParaleloMs || 0) + 'ms';
            document.getElementById('sequentialTime').textContent = (resultado.tiempoSecuencialMs || 0) + 'ms';
            document.getElementById('parallelTimeComp').textContent = (resultado.tiempoParaleloMs || 0) + 'ms';

            // Update charts
            updateDistributionChart(resultado);
            updateTimeChart(resultado);
        }

        function updateDistributionChart(resultado) {
            const ctx = document.getElementById('distributionChart').getContext('2d');

            if (distributionChart) {
                distributionChart.destroy();
            }

            distributionChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Errores', 'Warnings', 'Infos'],
                    datasets: [{
                        data: [
                            resultado.totalErrores || 0,
                            resultado.totalWarnings || 0,
                            resultado.totalInfos || 0
                        ],
                        backgroundColor: ['#ef4444', '#f59e0b', '#3b82f6'],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function updateTimeChart(resultado) {
            const ctx = document.getElementById('timeChart').getContext('2d');

            if (timeChart) {
                timeChart.destroy();
            }

            timeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Secuencial', 'Paralelo'],
                    datasets: [{
                        label: 'Tiempo (ms)',
                        data: [
                            resultado.tiempoSecuencialMs || 0,
                            resultado.tiempoParaleloMs || 0
                        ],
                        backgroundColor: ['#ef4444', '#10b981'],
                        borderRadius: 6,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Tiempo (ms)'
                            }
                        }
                    }
                }
            });
        }
    </script>

    <script>
        // Saludo por horario
        (function greet() {
            const h = new Date().getHours();
            const t = document.getElementById('greetingTitle');
            if (!t) return;
            let msg = '¬°Bienvenido!';
            if (h >= 5 && h < 12) msg = '¬°Buenos d√≠as!';
            else if (h >= 12 && h < 19) msg = '¬°Buenas tardes!';
            else msg = '¬°Buenas noches!';
            t.textContent = msg;
        })();

        // Mostrar / Ocultar contrase√±a
        (function togglePassword() {
            const btn = document.getElementById('togglePass');
            const input = document.getElementById('password');
            if (!btn || !input) return;
            btn.addEventListener('click', () => {
                const isPass = input.type === 'password';
                input.type = isPass ? 'text' : 'password';
            });
        })();

        // Recordar host/port/user en localStorage (no guardamos password)
        (function rememberFields() {
            const host = document.getElementById('host');
            const port = document.getElementById('port');
            const user = document.getElementById('user');
            const key = 'ssh-sentinel:last-conn';

            // Cargar
            try {
                const last = JSON.parse(localStorage.getItem(key) || '{}');
                if (last.host) host.value = last.host;
                if (last.port) port.value = last.port;
                if (last.user) user.value = last.user;
            } catch { }

            // Guardar al enviar
            document.getElementById('analysisForm').addEventListener('submit', () => {
                const data = { host: host.value.trim(), port: port.value.trim(), user: user.value.trim() };
                localStorage.setItem(key, JSON.stringify(data));
            });
        })();

        // Cambia el dot de estado seg√∫n respuesta de API
        (async function pingApi() {
            const dot = document.getElementById('apiStatusDot');
            if (!dot) return;
            try {
                // Intento r√°pido de HEAD/GET a la ra√≠z (ajusta a tu endpoint si tienes healthcheck)
                const res = await fetch('https://localhost:7082/', { method: 'GET', mode: 'no-cors' });
                // 'no-cors' no te da status, pero si no lanza error asumimos reachable
                dot.classList.remove('warn', 'err'); dot.classList.add('ok');
            } catch (e) {
                dot.classList.remove('ok'); dot.classList.add('warn'); // Advertencia si no responde
            }
        })();
    </script>


    <footer class="app-footer">
        <div>SSH Sentinel ‚Ä¢ v1.0</div>
        <div class="dot ok" id="apiStatusDot" title="Estado API"></div>
        <div class="footer-right">
            <a href="#" tabindex="-1">Pol√≠tica de privacidad</a>
            <span aria-hidden="true">‚Ä¢</span>
            <a href="#" tabindex="-1">Soporte</a>
        </div>
    </footer>

</body>

</html>